<div class="page-stack">
  <header class="page-header">
    <h1>Benchmark Runs</h1>
    <p>
      Create a run for each adapter and track scheduling and completion times.
    </p>
  </header>

  <section class="card-grid">
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">SolidQueue</h2>
        <div class="button-grid">
          <%= link_to "SolidQueue admin", "/solid_queue", class: "btn btn-outline btn-sm" %>
        </div>
        <div>
          <p class="text-sm font-semibold mb-2">Schedule one by one:</p>
          <div class="button-grid">
            <%= button_to "1k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 1000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "10k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 10000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "100k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 100000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "1M", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 1000000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
          </div>
        </div>
        <div>
          <p class="text-sm font-semibold mb-2">Schedule in bulk:</p>
          <div class="button-grid">
            <%= button_to "1k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 1000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "10k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 10000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "100k", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 100000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
            <%= button_to "1M", benchmark_runs_path,
              params: { benchmark_run: { gem: "solid_queue", jobs_count: 1000000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-primary btn-sm" %>
          </div>
        </div>
      </div>
    </div>

    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">GoodJob</h2>
        <div class="button-grid">
          <%= link_to "GoodJob admin", "/good_job", class: "btn btn-outline btn-sm" %>
        </div>
        <div>
          <p class="text-sm font-semibold mb-2">Schedule one by one:</p>
          <div class="button-grid">
            <%= button_to "1k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 1000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "10k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 10000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "100k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 100000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "1M", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 1000000, scheduling_mode: "one_by_one" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
          </div>
        </div>
        <div>
          <p class="text-sm font-semibold mb-2">Schedule in bulk:</p>
          <div class="button-grid">
            <%= button_to "1k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 1000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "10k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 10000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "100k", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 100000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
            <%= button_to "1M", benchmark_runs_path,
              params: { benchmark_run: { gem: "good_job", jobs_count: 1000000, scheduling_mode: "in_bulk" } },
              form_class: "button-grid-item", class: "btn btn-secondary btn-sm" %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="card-grid">
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">SolidQueue Runs</h2>
        <% if @solid_queue_runs.any? %>
          <div class="table-wrap">
            <table class="table table-zebra table-sm table-compact">
              <thead>
                <tr>
                  <th>Jobs</th>
                  <th>Mode</th>
                  <th>Created</th>
                  <th>Sched</th>
                  <th>Run</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @solid_queue_runs.each do |run| %>
                  <tr>
                    <td><%= jobs_count_label(run.jobs_count) %></td>
                    <td><%= compact_mode(run.scheduling_mode) %></td>
                    <td class="text-xs"><%= compact_datetime(run.created_at) %></td>
                    <td>
                      <%= duration_or_pending(run.scheduling_duration, run: run, show_progress: true) %>
                    </td>
                    <td>
                      <%= duration_or_pending(run.run_duration, run: run) %>
                    </td>
                    <td>
                      <%= button_to tag.span("×", class: "text-error"),
                        benchmark_run_path(run),
                        method: :delete,
                        data: { turbo_confirm: "Delete this run?" },
                        class: "btn btn-ghost btn-xs",
                        title: "Delete" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="alert alert-info">No SolidQueue runs yet.</div>
        <% end %>
      </div>
    </div>

    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">GoodJob Runs</h2>
        <% if @good_job_runs.any? %>
          <div class="table-wrap">
            <table class="table table-zebra table-sm table-compact">
              <thead>
                <tr>
                  <th>Jobs</th>
                  <th>Mode</th>
                  <th>Created</th>
                  <th>Sched</th>
                  <th>Run</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @good_job_runs.each do |run| %>
                  <tr>
                    <td><%= jobs_count_label(run.jobs_count) %></td>
                    <td><%= compact_mode(run.scheduling_mode) %></td>
                    <td class="text-xs"><%= compact_datetime(run.created_at) %></td>
                    <td>
                      <%= duration_or_pending(run.scheduling_duration, run: run, show_progress: true) %>
                    </td>
                    <td>
                      <%= duration_or_pending(run.run_duration, run: run) %>
                    </td>
                    <td>
                      <%= button_to tag.span("×", class: "text-error"),
                        benchmark_run_path(run),
                        method: :delete,
                        data: { turbo_confirm: "Delete this run?" },
                        class: "btn btn-ghost btn-xs",
                        title: "Delete" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="alert alert-info">No GoodJob runs yet.</div>
        <% end %>
      </div>
    </div>
  </section>

  <section>
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">Performance Visualization</h2>
        <% if @chart_data.values.any?(&:any?) %>
          <div
            data-controller="chart"
            data-chart-data-value="<%= ERB::Util.html_escape(@chart_data.to_json) %>"
            style="position: relative; height: 500px; width: 100%;"
          >
            <canvas></canvas>
          </div>
        <% else %>
          <div class="alert alert-info">No completed runs to display. Run some benchmarks to see the chart.</div>
        <% end %>
      </div>
    </div>
  </section>
</div>
